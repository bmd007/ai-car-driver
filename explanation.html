<!DOCTYPE html>
<html>
<head>
    <title>Robot Platform Hardware Communication Guide</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .component { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .gpio-table { border-collapse: collapse; width: 100%; margin: 10px 0; }
        .gpio-table th, .gpio-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .gpio-table th { background-color: #f2f2f2; }
        code { background-color: #f4f4f4; padding: 2px 4px; border-radius: 3px; }
    </style>
</head>
<body>
<h1>Robot Platform Hardware Communication Guide</h1>

<div class="component">
    <h2>1. Motor Control (PWM via PCA9685)</h2>
    <p><strong>Hardware:</strong> PCA9685 16-Channel PWM controller connected via I2C</p>
    <p><strong>I2C Address:</strong> 0x40</p>
    <p><strong>Bus:</strong> I2C Bus 1 (default on Raspberry Pi)</p>

    <h3>Motor Channel Mapping:</h3>
    <table class="gpio-table">
        <tr><th>Motor Position</th><th>PCA9685 Channel</th><th>Movement Direction</th></tr>
        <tr><td>Front Left</td><td>0</td><td>Positive: Forward, Negative: Backward</td></tr>
        <tr><td>Back Left</td><td>1</td><td>Positive: Forward, Negative: Backward</td></tr>
        <tr><td>Front Right</td><td>2</td><td>Positive: Forward, Negative: Backward</td></tr>
        <tr><td>Back Right</td><td>3</td><td>Positive: Forward, Negative: Backward</td></tr>
    </table>

    <h3>Communication Protocol:</h3>
    <ul>
        <li>Initialize PCA9685: Write 0x00 to register 0x00 (MODE1)</li>
        <li>Set PWM frequency to 50Hz for motors</li>
        <li>PWM values range: 0-4095 (12-bit resolution)</li>
        <li>Motor speed control: 0 = stop, ±2000 = medium speed, ±4095 = max speed</li>
    </ul>

    <h3>Movement Examples:</h3>
    <ul>
        <li><strong>Forward:</strong> All motors positive values (e.g., 2000, 2000, 2000, 2000)</li>
        <li><strong>Backward:</strong> All motors negative values (e.g., -2000, -2000, -2000, -2000)</li>
        <li><strong>Turn Left:</strong> Left motors negative, right motors positive</li>
        <li><strong>Turn Right:</strong> Left motors positive, right motors negative</li>
    </ul>
</div>

<div class="component">
    <h2>2. Servo Control (PWM via PCA9685)</h2>
    <p><strong>Hardware:</strong> Same PCA9685 controller as motors</p>

    <table class="gpio-table">
        <tr><th>Servo</th><th>PCA9685 Channel</th><th>Purpose</th></tr>
        <tr><td>Servo 0</td><td>4</td><td>Ultrasonic sensor rotation</td></tr>
        <tr><td>Servo 1</td><td>5</td><td>General purpose</td></tr>
    </table>

    <h3>Control Method:</h3>
    <ul>
        <li>PWM frequency: 50Hz</li>
        <li>Pulse width: 500-2500 microseconds</li>
        <li>Angle range: 0-180 degrees</li>
        <li>Calculation: <code>pulse_value = (pulse_microseconds * 4096) / 20000</code></li>
    </ul>
</div>

<div class="component">
    <h2>3. LED Control</h2>
    <p><strong>Hardware:</strong> WS2812B LED strip (8 LEDs)</p>

    <h3>Connection Options:</h3>
    <table class="gpio-table">
        <tr><th>Connect Version</th><th>Pi Version</th><th>Interface</th><th>GPIO Pin</th></tr>
        <tr><td>1</td><td>4 or earlier</td><td>Direct GPIO (PWM)</td><td>GPIO 18</td></tr>
        <tr><td>2</td><td>Any</td><td>SPI</td><td>GPIO 10 (MOSI)</td></tr>
    </table>

    <h3>Communication Protocol:</h3>
    <ul>
        <li><strong>WS2812B Protocol:</strong> Each LED requires 24 bits (8 bits per RGB channel)</li>
        <li><strong>SPI Method:</strong> Convert each bit to SPI timing pattern</li>
        <li><strong>Color Format:</strong> Can be RGB, GRB, or other arrangements depending on version</li>
        <li><strong>Control:</strong> Send data for all 8 LEDs in sequence</li>
    </ul>

    <h3>LED Operations:</h3>
    <ul>
        <li><strong>Set Individual LED:</strong> Send RGB values (0-255 each) for specific LED index</li>
        <li><strong>Set All LEDs:</strong> Send same RGB values to all 8 LEDs</li>
        <li><strong>Brightness Control:</strong> Scale RGB values by brightness factor (0-255)</li>
    </ul>
</div>

<div class="component">
    <h2>4. Ultrasonic Sensor</h2>
    <p><strong>Hardware:</strong> HC-SR04 ultrasonic distance sensor</p>

    <table class="gpio-table">
        <tr><th>Pin Function</th><th>GPIO Pin</th><th>Purpose</th></tr>
        <tr><td>Trigger</td><td>GPIO 27</td><td>Send 10μs pulse to start measurement</td></tr>
        <tr><td>Echo</td><td>GPIO 22</td><td>Receive pulse duration proportional to distance</td></tr>
    </table>

    <h3>Measurement Process:</h3>
    <ol>
        <li>Set trigger pin HIGH for 10 microseconds</li>
        <li>Set trigger pin LOW</li>
        <li>Measure duration of HIGH pulse on echo pin</li>
        <li>Calculate distance: <code>distance_cm = (pulse_duration * 34300) / 2000000</code></li>
    </ol>
</div>

<div class="component">
    <h2>5. Infrared Line Sensors</h2>
    <p><strong>Hardware:</strong> 3 digital infrared sensors for line following</p>

    <table class="gpio-table">
        <tr><th>Sensor Position</th><th>GPIO Pin</th><th>Reading</th></tr>
        <tr><td>Left (Channel 1)</td><td>GPIO 14</td><td>0 = Line detected, 1 = No line</td></tr>
        <tr><td>Center (Channel 2)</td><td>GPIO 15</td><td>0 = Line detected, 1 = No line</td></tr>
        <tr><td>Right (Channel 3)</td><td>GPIO 23</td><td>0 = Line detected, 1 = No line</td></tr>
    </table>

    <h3>Reading Method:</h3>
    <ul>
        <li>Read GPIO pins as digital inputs</li>
        <li>Combine readings into single value: <code>combined = (left << 2) | (center << 1) | right</code></li>
        <li>Result range: 0-7, where each bit represents a sensor state</li>
    </ul>
</div>

<div class="component">
    <h2>6. ADC (Analog-to-Digital Converter)</h2>
    <p><strong>Hardware:</strong> ADS7830 8-bit ADC connected via I2C</p>
    <p><strong>I2C Address:</strong> 0x4B</p>

    <table class="gpio-table">
        <tr><th>Channel</th><th>Purpose</th><th>Voltage Range</th></tr>
        <tr><td>0</td><td>Left photoresistor</td><td>0-3.3V (PCB v2) / 0-5V (PCB v1)</td></tr>
        <tr><td>1</td><td>Right photoresistor</td><td>0-3.3V (PCB v2) / 0-5V (PCB v1)</td></tr>
        <tr><td>2</td><td>Battery voltage divider</td><td>0-3.3V (PCB v2) / 0-5V (PCB v1)</td></tr>
    </table>

    <h3>Reading Process:</h3>
    <ol>
        <li>Send channel selection command to ADS7830</li>
        <li>Read 8-bit digital value (0-255)</li>
        <li>Convert to voltage: <code>voltage = (adc_value / 255) * reference_voltage</code></li>
        <li>Reference voltage depends on PCB version (3.3V or 5V)</li>
    </ol>
</div>

<div class="component">
    <h2>7. Buzzer Control</h2>
    <p><strong>Hardware:</strong> PWM-controlled buzzer</p>
    <p><strong>Control:</strong> Via PCA9685 PWM controller, channel varies by configuration</p>

    <h3>Sound Generation:</h3>
    <ul>
        <li>Set PWM frequency to desired tone frequency (e.g., 440Hz for A note)</li>
        <li>Set duty cycle to 50% for maximum volume</li>
        <li>Control duration by timing the PWM on/off</li>
    </ul>
</div>

<div class="component">
    <h2>8. Camera Control</h2>
    <p><strong>Hardware:</strong> Raspberry Pi Camera Module</p>
    <p><strong>Interface:</strong> CSI (Camera Serial Interface)</p>

    <h3>Operations:</h3>
    <ul>
        <li><strong>Image Capture:</strong> Configure resolution and capture single frame</li>
        <li><strong>Video Stream:</strong> Continuous JPEG or H.264 encoding</li>
        <li><strong>Configuration:</strong> Set resolution, flip options, preview settings</li>
    </ul>
</div>

<div class="component">
    <h2>9. I2C Bus Configuration</h2>
    <p><strong>Default I2C Bus:</strong> Bus 1 (/dev/i2c-1)</p>
    <p><strong>GPIO Pins:</strong> SDA (GPIO 2), SCL (GPIO 3)</p>

    <table class="gpio-table">
        <tr><th>Device</th><th>I2C Address</th><th>Purpose</th></tr>
        <tr><td>PCA9685</td><td>0x40</td><td>PWM controller for motors/servos</td></tr>
        <tr><td>ADS7830</td><td>0x4B</td><td>8-channel ADC</td></tr>
    </table>
</div>

<div class="component">
    <h2>10. Platform Versions and Compatibility</h2>

    <h3>Hardware Versions:</h3>
    <table class="gpio-table">
        <tr><th>Component</th><th>Version 1</th><th>Version 2</th></tr>
        <tr><td>Connect Board</td><td>Direct GPIO control</td><td>Enhanced I2C/SPI</td></tr>
        <tr><td>PCB</td><td>5V reference</td><td>3.3V reference</td></tr>
        <tr><td>Raspberry Pi</td><td>Pi 4 and earlier</td><td>Pi 5 support</td></tr>
    </table>

    <h3>Key Differences:</h3>
    <ul>
        <li><strong>LED Control:</strong> v1 uses GPIO PWM, v2 uses SPI</li>
        <li><strong>ADC Reference:</strong> v1 uses 5V, v2 uses 3.3V</li>
        <li><strong>Pi 5 Compatibility:</strong> Only supported with Connect v2</li>
    </ul>
</div>

<div class="component">
    <h2>11. Implementation Summary</h2>

    <h3>Required Interfaces:</h3>
    <ul>
        <li><strong>I2C:</strong> Motor/servo control (PCA9685), ADC readings (ADS7830)</li>
        <li><strong>GPIO:</strong> Ultrasonic sensor, infrared sensors</li>
        <li><strong>SPI:</strong> LED control (version 2 only)</li>
        <li><strong>PWM:</strong> LED control (version 1 only)</li>
        <li><strong>CSI:</strong> Camera interface</li>
    </ul>

    <h3>Initialization Sequence:</h3>
    <ol>
        <li>Detect platform version from configuration file</li>
        <li>Initialize I2C bus for PCA9685 and ADS7830</li>
        <li>Configure GPIO pins for sensors</li>
        <li>Initialize appropriate LED interface (GPIO/SPI)</li>
        <li>Set up camera interface</li>
        <li>Configure PWM frequencies and initial states</li>
    </ol>
</div>

</body>
</html>
